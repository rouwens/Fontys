- name: Install elasticsearch
  hosts: elk

tasks:
  - name: Import Elasticstack key
    ansible.builtin.rpm_key:
      state: present
      key: http://apt.sw.be/RPM-GPG-KEY.dag.txt

  # Install Elasticsearch

  - name: Install Elasticsearch
    yum:
      name: https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-x86_64.rpm
      state: present
    
  # Update Elasticsearch config file to allow access (to secure Elasticsearch, bind to 'localhost'). 

  - name: Updating the config file to allow outside access
    lineinfile:
    destfile: /etc/elasticsearch/elasticsearch.yml
    regexp: 'network.host:'
    line: 'network.host: 0.0.0.0'
  
  # Update Elasticsearch port in config file 

  - name: Updating the port in config file 
    lineinfile:
    destfile: /etc/elasticsearch/elasticsearch.yml
    regexp: 'http.port:'
    line: 'http.port: 9200'
  
  # Start Elasticsearch
  - name: Starting Elasticsearch
    service:
    name: elasticsearch
    state: started